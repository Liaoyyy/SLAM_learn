# 基础概念
- msg:发送的文件信息
- srv:描述service服务，由request和response组成

**相关shell命令:**
- rosmsg 
- rossrv

**包含的库要求:**
1. CMakeList.txt中加入
   ```cmake
   find_package(catkin REQUIRED COMPONENTS
   roscpp
   rospy
   std_msgs
   message_generation
   )

   # Num即为msg名称
   add_message_files(
   FILES
   Num.msg
   )

   # AddTwoInts即为srv名称
   add_service_files(
   FILES
   AddTwoInts.srv
   )

   generate_messages(
   DEPENDENCIES
   std_msgs
   )

   # 创建可执行文件
   # 配置CMakeLists.txt中的编译规则
   # 1. 设置需要编译的代码和生成可执行文件 add_executable
   # 2. 设置链接库target_link_libraries

   # Publisher + Subscriber模式
   add_executable(talker src/talker.cpp)
   target_link_libraries(talker ${catkin_LIBRARIES})
   add_dependencies(talker beginner_tutorials_generate_messages_cpp)

   add_executable(listener src/listener.cpp)
   target_link_libraries(listener ${catkin_LIBRARIES})
   add_dependencies(listener beginner_tutorials_generate_messages_cpp)

   # Server + Client模式
   add_executable(add_two_ints_server src/add_two_ints_server.cpp)
   target_link_libraries(add_two_ints_server ${catkin_LIBRARIES})
   add_dependencies(add_two_ints_server beginner_tutorials_gencpp)

   add_executable(add_two_ints_client src/add_two_ints_client.cpp)
   target_link_libraries(add_two_ints_client ${catkin_LIBRARIES})
   add_dependencies(add_two_ints_client beginner_tutorials_gencpp)
   ```
2. package.xml中加入
   ```cmake
   <build_depend>message_generation</build_depend>
   <exec_depend>message_runtime</exec_depend>
   ```

# Publisher + Subscriber方式
*Publisher + Subscriber方式由publisher发布一个topic，多个Subscriber均可订阅该topic的信息*

**例子：**

发布者(Publisher)
```C++
#include "ros/ros.h"
#include "std_msgs/String.h"

#include <sstream>

int main(int argc, char **argv)
{
  // ros::init()函数可初始化ROS节点，talker为节点名
  ros::init(argc, argv, "talker");

  // 创建节点句柄
  ros::NodeHandle n;

  // 创建一个类型为std_msgs::String的topic，名为chatter，消息队列大小为1000
  ros::Publisher chatter_pub = n.advertise<std_msgs::String>("chatter", 1000);

  // 消息发送波特率为10
  ros::Rate loop_rate(10);

  /**
   * ros::ok()返回false情况
   * 收到Ctrl-C
   * 被同名节点顶替
   * 所有ros::NOdeHandles被销毁
   */
  int count = 0;
  while (ros::ok())
  {
    // 创建该类型消息
    std_msgs::String msg;

    std::stringstream ss;
    ss << "hello world " << count;
    msg.data = ss.str();

    // 即类似于printf/cout
    ROS_INFO("%s", msg.data.c_str());

    // 发布消息
    chatter_pub.publish(msg);

    ros::spinOnce();
    // 休眠，以达到10Hz波特率
    loop_rate.sleep();
    ++count;
  }
  return 0;
}
```

订阅者(Subscriber)
```C++
#include "ros/ros.h"
#include "std_msgs/String.h"

// 收到消息后的回调函数
void chatterCallback(const std_msgs::String::ConstPtr& msg)
{
  ROS_INFO("I heard: [%s]", msg->data.c_str());
}

int main(int argc, char **argv)
{
  // 同样的初始化节点并创建句柄
  ros::init(argc, argv, "listener");
  ros::NodeHandle n;

  // n.subscribe订阅名为chatter的topic，消息队列长度为1000，回到函数为chatterCallback
  ros::Subscriber sub = n.subscribe("chatter", 1000, chatterCallback);

  // ros::spin()将进入循环，当收到消息时被唤醒进入回调函数
  ros::spin();

  return 0;
}
```

# Server + Client方式
*Server+Clinet方式为一对一通信方式,Client发送请求Request，Server响应并回复Response*

**例子:**
服务端（Service）:
```C++
#include "ros/ros.h"
#include "beginner_tutorials/AddTwoInts.h" //AddTwoInts.h为srv文件下AddTwoInts通过CMakeList.txt生成的.h头文件

// 回调函数，包含request+response两个输入变量
bool add(beginner_tutorials::AddTwoInts::Request  &req,
         beginner_tutorials::AddTwoInts::Response &res)
{
  res.sum = req.a + req.b;
  ROS_INFO("request: x=%ld, y=%ld", (long int)req.a, (long int)req.b);
  ROS_INFO("sending back response: [%ld]", (long int)res.sum);
  return true;
}

int main(int argc, char **argv)
{
  ros::init(argc, argv, "add_two_ints_server");
  ros::NodeHandle n;

  // 创建接受服务端，订阅名为add_two_ints的服务数据，回调函数为add
  ros::ServiceServer service = n.advertiseService("add_two_ints", add);
  ROS_INFO("Ready to add two ints.");

  // 等待消息，当收到话题数据时进入回调函数
  ros::spin();

  return 0;
}
```

客户端（Client）:
```C++
#include "ros/ros.h"
#include "beginner_tutorials/AddTwoInts.h"
#include <cstdlib>

int main(int argc, char **argv)
{
  ros::init(argc, argv, "add_two_ints_client");
  if (argc != 3)
  {
    ROS_INFO("usage: add_two_ints_client X Y");
    return 1;
  }

  ros::NodeHandle n;
  
  //创建类型为AddTwoInts的服务客户端，连接名为add_two_ints的服务
  ros::ServiceClient client = n.serviceClient<beginner_tutorials::AddTwoInts>("add_two_ints");

  //创建AddTwoInts类型请求数据srv
  beginner_tutorials::AddTwoInts srv;
  srv.request.a = atoll(argv[1]);
  srv.request.b = atoll(argv[2]);

  //client.call()函数请求数据发送
  if (client.call(srv))
  {
    ROS_INFO("Sum: %ld", (long int)srv.response.sum);
  }
  else
  {
    ROS_ERROR("Failed to call service add_two_ints");
    return 1;
  }

  return 0;
}
```

